<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <title>Convert</title>
  </head>
  <body>
    <div class="row">
      <div class="col">
        <h1>Convert HTML to Schema!</h1>
      </div>
      <div class="col text-right">
        <button class="btn btn-primary" id="convert_btn">Convert</button>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <div class="mb-3">
          <label for="exampleFormControlTextarea1" class="form-label"
            >Original HTML</label
          >
          <textarea class="form-control" id="origin" rows="20"></textarea>
        </div>
      </div>
      <div class="col">
        <div class="mb-3">
          <label for="exampleFormControlTextarea1" class="form-label"
            >Schema</label
          >
          <!-- <textarea class="form-control" id="converted" rows="20"></textarea> -->
          <div id="converted"></div>
        </div>
      </div>
    </div>
    <div id="raw_html" style="display: none"></div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      const getClassList = (component) => {
        const classList = component.attr("class");
        return classList.split(/\s+/).filter((item) => item !== "yui_content");
      };

      function copyToClipboard(element) {
        const $temp = $("<input>");
        $("body").append($temp);
        $temp.val($(element).text()).select();
        document.execCommand("copy");
        $temp.remove();
      }

      $("#convert_btn").click(function () {
        let res = "";
        $("#raw_html").html($("#origin").val());
        const $raw = $("#raw_html");
        const contents = $("#raw_html").find(".yui_content_box");
        for (let i = 0; i < contents.length; i++) {
          const $content = $(contents[i]);
          const $label = $content.find("span.yui_label");
          let $component = $content.find("div.yui_content");
          let clsList = getClassList($component);
          if (clsList.find((e) => e === "hform-date")) {
            $component = $component.find("div");
            clsList = getClassList($component);
          }
          const source = $component.data("source");
          const url = $component.data("url");
          const label = $label.html().trim();
          const field = $component.data("name");
          const placeholder = $component.data("place-holder");
          const url_label = $component.data("text-field");
          const url_field = $component.data("value-field");
          if (clsList[0] === "yui-combobox") {
            if (source) {
              res += `genSearchSchema('sourceSelect', '${field}', '${label}', {
                        placeholder: ${
                          placeholder ? `'${placeholder}'` : "null"
                        },
                        options: ${source} as any
                      }), \n`;
            } else if (url) {
              res += `genSearchSchema('apiSelect', '${field}', '${label}', {
                        placeholder: ${
                          placeholder ? `'${placeholder}'` : "null"
                        },
                        api: async () => {
                          return await getInOptionFormat('${url}', '${url_field}', '${url_label}')
                        }
                      }),\n`;
            }
          } else if (clsList[0] === "yui-datebox") {
            res += `genSearchSchema('datePicker', '${field}', '${label}', {
              placeholder: ${placeholder ? `'${placeholder}'` : "null"}
            }), \n`;
          } else if (clsList[0] === "yui-textbox") {
            res += `genSearchSchema('input', '${field}', '${label}', {
              placeholder: ${placeholder ? `'${placeholder}'` : "null"}
            }), \n`;
          } else {
            alert(clsList[0]);
          }
        }
        $("#converted").html(res);
        copyToClipboard("#converted");
      });
    </script>
  </body>
</html>
